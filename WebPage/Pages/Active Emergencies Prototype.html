<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Breakeven 
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20130509

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Emergency Center</title>
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Abel|Satisfy' rel='stylesheet' type='text/css'>
<link href="style.css" rel="stylesheet" type="text/css" media="screen" />

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!--<script type="text/javascript" src="http://www.json.org/json2.js"></script>-->

<script>
<!-----------TRANSFORMS a String Object to a JSON Object--------->
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};

<!-----------CHANGES Sidebar from show to add Emergency-------->

$(function(){
  $("#change").click(function(){
    $("#sidebar1").css("display","none");
    $("#sidebar2").css("display","inline");
	$("#show").attr("disabled", true);
	$("#edit").attr("disabled", true);
	$("#delete").attr("disabled", true);
  });
});

<!------------------ADDS a Client with an Emergency to Local Storage--------------->
$(function() {
    $("#add").submit(function() {
       
		var key = $("#clientPhoneNumber").val();
		var timestamp = new Date();
		var JSONObject = JSON.stringify($("#add").serializeObject());
		$("#timeStamp").val(timestamp);
		localStorage.setItem( key , JSONObject );
		
		
<!---------------ADDS the Emergency Information to the Active Emergencies container------>    		
		var texto = JSON.parse(JSONObject).clientName + ", " +JSON.parse(JSONObject).clientPhoneNumber + ", " +JSON.parse(JSONObject).attendedBy;
		
		var radioBtn = $('<input id="'+ key +'" type="radio" name="active" value=' + '"'+ key + '"' +'>'+texto+'------------------------Active</input><br>');
		$("#active").append(radioBtn);
		
		
<!--------------CHANGES HTML Doc to initial state----------------------------------->		
		$("#sidebar1").css("display","inline");
		$("#sidebar2").css("display","none");
		$("#show").attr("disabled", false);
		$("#edit").attr("disabled", false);
		$("#delete").attr("disabled", false);
		$('#add').trigger("reset");
		location.reload();
		
        return false;
    });
});
<!---------------------RE-POPULATES de Active Emergencies container if the window is closed or refreshed-------------->
$(window).load(function () {
				var storageElements = localStorage.length;
				
				if (storageElements == 0){
				return false;
				
				}else{
					var i,key,JSONObject;
					var localStorageKeys = Object.keys(localStorage);
					for ( i = 0; i < storageElements; i++){
					key =  localStorageKeys[i];
				
					JSONObject = localStorage.getItem(key);
					
					
					var texto = JSON.parse(JSONObject).clientName + ", " +JSON.parse(JSONObject).clientPhoneNumber + ", " +JSON.parse(JSONObject).attendedBy;
		
					
					
					var radioBtn = $('<input id="'+ key +'" type="radio" name="active" value=' + '"'+ key + '"' +'>'+texto+'------------------------Active</input><br>');
					$('#active').append(radioBtn);
					
									
					
					}
				
				}
		return false;
		});

<!--------------------------------------EDITS information of an Emergency---------------------------------------------------->
$(function(){
  $("#edit").click(function(){
    var JSONkey, JSONObject, key;
	JSONkey = JSON.stringify($('#main').serializeObject());
	key = JSON.parse(JSONkey).active;
	
	if(typeof key != "undefined"){
	
	$("#sidebar1").css("display","none");
    $("#sidebar2").css("display","inline");
	$("#show").attr("disabled", true);
	$("#change").attr("disabled", true);
	$("#delete").attr("disabled", true);
	
	
	JSONObject = localStorage.getItem(key);

	$("#clientPhoneNumber").val(JSON.parse(JSONObject).clientPhoneNumber);
	$("#clientName").val(JSON.parse(JSONObject).clientName);
	$("#clientAddress").val(JSON.parse(JSONObject).clientAddress);
	<!--$("#typeOfEmergency").val(JSON.parse(JSONObject).typeOfEmergency);-->
	if ( JSON.parse(JSONObject).outsideHome == "No"){
	$("#no").prop("checked", true);
	$("#yes").prop("checked", false);
	}
	$("#attendedBy").val(JSON.parse(JSONObject).attendedBy);
	$("#emergencyDetails").val(JSON.parse(JSONObject).emergencyDetails);
	<!--$("#clientPhoneNumber").val(JSON.parse(JSONObject).clientPhoneNumber);-->
	
	
	}
  });
});






<!------------------------REMOVES an Emergency from the Active window and localStorage and sends the information to the DB---------------->
$(function(){
	$("#delete").click(function(){
		var JSONkey, key;
		JSONkey = JSON.stringify($('#main').serializeObject());
		key = JSON.parse(JSONkey).active;
		
		if(typeof key != "undefined"){
		
		localStorage.removeItem(key);
		alert("The information for emergency with Telephone number "+key+" has been saved to the Data Base");
		location.reload();
		}
	
		return false;
			
	});
});



<!----------------------DISPLAYS the information of the emergency on screen along with the clients location(map)-------------->

$(function() {
    $("#show").click(function() {
        
			var JSONkey, JSONObject, key, position;
			JSONkey = JSON.stringify($('#main').serializeObject());
			key = JSON.parse(JSONkey).active;
			
			if ( typeof key != "undefined"){
			
			JSONObject = localStorage.getItem(key);
			$("#cpn").html(JSON.parse(JSONObject).clientPhoneNumber);
			$("#n").html(JSON.parse(JSONObject).clientName);
			$("#a").html(JSON.parse(JSONObject).clientAddress);
			$("#toe").html(JSON.parse(JSONObject).typeOfEmergency);
			$("#eah").html(JSON.parse(JSONObject).outsideHome);
			$("#aa").html(JSON.parse(JSONObject).attendedBy);
			$("#ed").html(JSON.parse(JSONObject).emergencyDetails);
			position = JSON.parse(JSONObject).latitude + ', ' + JSON.parse(JSONObject).longitude; 
			$("#cl").html("0,0");
			}
			
			
		return false;
	});
});
<!---------------Alerts User if leaving the page while editing----------->


$( window ).unload(function() {
  alert( "Handler for .unload() called." );
});


<!--Shares the clients information with another agency-->
function relayInfo()
{

}

<!--------------------------------------------TEST FUNCTIONS ONLY------------------------------------------------------------------------>
$(function(){
	$('#formData').submit(function(){
		
		var dataKey = $('#keyFetcher').val();
		
		var actualStorageSize = JSON.stringify(localStorage).length;
		$('#result').text("KEY = "+ dataKey + " DATA = " + localStorage.getItem(dataKey) + " SIZE = " + actualStorageSize + " Bytes");
		return false;
    })
})

function storageReset()
{
localStorage.clear();
}

</script>

</head>
<body>
<div id="wrapper">
	<div id="header-wrapper">
		<div id="header" class="container">
			<div id="logo">
				<h1><a href="#">Emergency Center</a></h1>
			</div>
			<div id="menu">
				<ul>
					<li class="current_page_item"><a href="#">Homepage</a></li>
					<li><a href="C:\Users\Ricardo\Documents\GitHub\EmergencyAssistantAppWebpage\WebPage\Pages\History Prototype.html">History</a></li>
					<li><a href="#">Account Information</a></li>
					<li><a href="#">Log out</a></li>
					
				</ul>
			</div>
		</div>
	</div>
	<!-- end #header -->
	<div id="page">
		<div id="content">
			<div class="post">
				
				<div class="entry">
					<!--Aqui va lo de Active y Relayed Emergencies-->
					


					

					<h1>Relayed Emergencies</h1>

					<div id="relayed"class="container2">
					

					</div>
					
					
					<h1>Active Emergencies</h1>
					
					
					<form id="main">
					<div id="active" class="container2">
					
					
					</div>
					</form>
					
					
					
					<p>
					<button id="change" type="button" class="more">Add Emergency</button>
					<button id="show" type="button" class="more" onclick="" form="main">Show Emergency Information</button>
					</p>

					<p>
					<button id="edit" type="button" class="more" onclick="" form="main">Edit Emergency</button>
					<button id="delete" type="button" class="more" onclick="" form="main">Mark as Resolved</button>
					</p>

					
					
					
					
					
					
				</div>
			</div>
		</div>
		<!-- end #content -->
		<div id="sidebar1">
			<ul>
				<li>
					<h2>Emergency Information</h2>
					<ul>
						<li>Client Phone Number:<h1 id="cpn"></h1> </li>
						<li>Name:<h1 id="n"></h1></li>
						<li>Address:<h1 id="a"></h1></li>
						<li>Type of Emergency:<h1 id="toe"></h1></li>
						<li>Emergency at Home?:<h1 id="eah"></h1></li>
						<li>Assigned Agent: <h1 id="aa"></h1></li>
						<li>Emergency Description:<br><div id="container3"><p id="ed"></p></div></li>
						<!--<li>Relay Description(If any):<br></li>-->
						<li>Client Location:<h1 id="cl"></h1></li>
						
					</ul>
				</li>
			</ul>
		</div>
		<form id="add" action="" method="post">
		<div id="sidebar2">
			<ul>
				<li>
					<h2>Emergency Information</h2>
					<ul>
						<form id="add" action="" method="post">
						<li>Client Phone Number: <input id="clientPhoneNumber"type="text" name="clientPhoneNumber" maxlength="10" size="10" required/></li>
						<li>Name:<input id="clientName" type="text" name="clientName" maxlength="40" size="30"required></li>
						<li>Address:<input id="clientAddress" type="text" name="clientAddress" maxlength="100" size="30" required></li>
						<li>Type of Emergency:<select id="typeOfEmergency" name="typeOfEmergency" size="1" placeholder="Select Type" required>
							<option value="Type1">Type 1</option>
							<option value="Type2">Type 2</option>
							<option value="Type3">Type 3</option></select></li>
						<li>Emergency at Home?:<input id="yes" type="radio" name="outsideHome" value="Yes" checked >Yes</input><input id="no" type="radio" name="outsideHome" value="No" >No</input></li>
						<li>Assigned Agent: <input id="attendedBy" type="text" name="attendedBy" maxlength="40" ></li>
						<li>Emergency Description:<br><textarea id="emergencyDetails" rows="7" cols="40" name="emergencyDetails" maxlegth="500" placeholder="Short description of the emergency" required></textarea></li>
						<!--<li>Relay Description(If any):<br><textarea rows="4" cols="30" name="reason" maxlegth="500" placeholder="Short description for the Relay" required></textarea></li>-->
						<li>Client Location:<input type=hidden name="latitude" ><input type=hidden name="longitude" ></li>
						<button id="save" type="submit" class="more">Submit</button>
						
						</form>
					</ul>
				</li>
			</ul>
		</div>
		</form>
		<!-- end #sidebar -->
		<div style="clear: both;">&nbsp;</div>
	</div>
	<!-- end #page --> 
	
</div>
<div id="footer">
	<p>Copyright (c) 2013 Sitename.com. All rights reserved. Images by <a href="http://fotogrph.com/">Fotogrph</a>. Design by <a href="http://www.freecsstemplates.org/" rel="nofollow">FreeCSSTemplates.org</a>.</p>
</div>
<!-- end #footer -->
</body>
</html>
