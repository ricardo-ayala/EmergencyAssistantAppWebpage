<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Breakeven 
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20130509

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Account Settings</title>
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Abel|Satisfy' rel='stylesheet' type='text/css'>
<link href="style.css" rel="stylesheet" type="text/css" media="screen" />

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!--<script type="text/javascript" src="http://www.json.org/json2.js"></script>-->

<script>
<!-----------TRANSFORMS a String Object to a JSON Object--------->
$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();
    $.each(a, function() {
        if (o[this.name] !== undefined) {
            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');
        } else {
            o[this.name] = this.value || '';
        }
    });
    return o;
};

<!-----------CHANGES Sidebar from show to add Emergency-------->

$(function(){
  $("#change").click(function(){
    $("#sidebar1").css("display","none");
    $("#sidebar2").css("display","inline");
	$("#show").attr("disabled", true);
	$("#edit").attr("disabled", true);
	$("#delete").attr("disabled", true);
	$("change").attr("disabled", true);
	$("#changeRelay").attr("disabled", true);
	$("#save").attr("disabled", false);
  });
});

<!------------------ADDS a Client with an Emergency to Local Storage--------------->
$(function() {
    $("#add").submit(function() {
		
		var key = $("#clientPhoneNumber").val();
		localStorage.removeItem(key);
		if ( $("#timeStamp").val() == "" )
		{
		var timestamp = new Date();
		var month = timestamp.getMonth()+1;
		var day = timestamp.getDate();

		var time = timestamp.getFullYear() + '/' +
			((''+month).length<2 ? '0' : '') + month + '/' +
			((''+day).length<2 ? '0' : '') + day +" "+ timestamp.getHours()+":"+timestamp.getMinutes()+":"+timestamp.getSeconds();
		
		$("#timeStamp").val(time);
		}
		
		
		
		var JSONObject = JSON.stringify($("#add").serializeObject());
		localStorage.setItem( key , JSONObject );
		
		
<!---------------ADDS the Emergency Information to the Active Emergencies container------>    		
		var texto = JSON.parse(JSONObject).clientName + ", " +JSON.parse(JSONObject).clientPhoneNumber + ", " +JSON.parse(JSONObject).attendedBy;
		
		var radioBtn = $('<input id="'+ key +'" type="radio" name="active" value=' + '"'+ key + '"' +'>'+texto+'------------------------Active</input><br>');
		$("#active").append(radioBtn);
		
		
		
		
<!--------------CHANGES HTML Doc to initial state----------------------------------->		
		$("#sidebar1").css("display","inline");
		$("#sidebar2").css("display","none");
		$("#show").attr("disabled", false);
		$("#edit").attr("disabled", false);
		$("#delete").attr("disabled", false);
		$("change").attr("disabled", false);
		$("#changeRelay").attr("disabled", false);
		$("#add").trigger("reset");
		$("#save").attr("disabled", true);
		location.reload();
		
        return false;
    });
});
<!---------------------RE-POPULATES de Active Emergencies container if the window is closed or refreshed-------------->
$(window).load(function () {
				
				
				
				var storageElements = localStorage.length;
				
				if (storageElements == 0){
				return false;
				
				}else{
					var i,key,JSONObject;
					var localStorageKeys = Object.keys(localStorage);
					for ( i = 0; i < storageElements; i++){
					key =  localStorageKeys[i];
				
					JSONObject = localStorage.getItem(key);
					
					
					var texto = JSON.parse(JSONObject).clientName + ", " +JSON.parse(JSONObject).clientPhoneNumber + ", " +JSON.parse(JSONObject).attendedBy;
		
					
					
					var radioBtn = $('<input id="'+ key +'" type="radio" name="active" value=' + '"'+ key + '"' +'>'+texto+'------------------------Active</input><br>');
					$('#active').append(radioBtn);
					
									
					
					}
				
				}
		return false;
		});

	

	
		
<!--------------------------------------EDITS information of an Emergency---------------------------------------------------->
$(function(){
  $("#edit").click(function(){
    var JSONkey, JSONObject, key;
	JSONkey = JSON.stringify($('#main').serializeObject());
	key = JSON.parse(JSONkey).active;
	
	if(typeof key != "undefined"){
	
	$("#sidebar1").css("display","none");
    $("#sidebar2").css("display","inline");
	$("#show").attr("disabled", true);
	$("#change").attr("disabled", true);
	$("#delete").attr("disabled", true);
	$("change").attr("disabled", true);
	$("#changeRelay").attr("disabled", true);
	$("#save").attr("disabled", false);
	
	
	JSONObject = localStorage.getItem(key);

	$("#clientPhoneNumber").val(JSON.parse(JSONObject).clientPhoneNumber);
	$("#clientName").val(JSON.parse(JSONObject).clientName);
	$("#clientAddress").val(JSON.parse(JSONObject).clientAddress);
	
	if ( JSON.parse(JSONObject).outsideHome == "No"){
	$("#no").prop("checked", true);
	$("#yes").prop("checked", false);
	}
	$("#attendedBy").val(JSON.parse(JSONObject).attendedBy);
	$("#emergencyDetails").val(JSON.parse(JSONObject).emergencyDetails);
	$("#timeStamp").val(JSON.parse(JSONObject).timeStamp);
	$("#oldAgencyPhoneNumber").val(JSON.parse(JSONObject).oldAgencyPhoneNumber);
	$("#newAgencyPhoneNumber").val(JSON.parse(JSONObject).newAgencyPhoneNumber);
	$("#reason").val(JSON.parse(JSONObject).reason);
	
	
	

	<!--$(window).on('beforeunload ',function() {

	<!--return "If you leave now the information on screen will be lost";
	
	<!--});
	
	
	
		}
	});

});




<!------------------------REMOVES an Emergency from the Active window and localStorage and sends the information to the DB---------------->
$(function(){
	$("#delete").click(function(){
		var JSONkey, key;
		JSONkey = JSON.stringify($('#main').serializeObject());
		key = JSON.parse(JSONkey).active;
		
		if(typeof key != "undefined"){
		
		localStorage.removeItem(key);
		alert("The information for emergency with Telephone number "+key+" has been saved to the Data Base");
		location.reload();
		}
	
		return false;
			
	});
});



<!----------------------DISPLAYS the information of the emergency on screen along with the clients location(map)-------------->

$(function() {
    $("#show").click(function() {
        
			var JSONkey, JSONObject, key, position;
			JSONkey = JSON.stringify($('#main').serializeObject());
			key = JSON.parse(JSONkey).active;
			
			if ( typeof key != "undefined"){
			
			JSONObject = localStorage.getItem(key);
			$("#cpn").html(JSON.parse(JSONObject).clientPhoneNumber);
			$("#n").html(JSON.parse(JSONObject).clientName);
			$("#a").html(JSON.parse(JSONObject).clientAddress);
			$("#toe").html(JSON.parse(JSONObject).typeOfEmergency);
			$("#eah").html(JSON.parse(JSONObject).outsideHome);
			$("#aa").html(JSON.parse(JSONObject).attendedBy);
			$("#ed").html(JSON.parse(JSONObject).emergencyDetails);
			$("#rd").html(JSON.parse(JSONObject).reason);
			$("#ts").html(JSON.parse(JSONObject).timeStamp);
			position = JSON.parse(JSONObject).latitude + ', ' + JSON.parse(JSONObject).longitude; 
			$("#cl").html("");
			}
			
			
		return false;
	});
});



<!-----------------Relays clients information with another agency----------------->

$(function(){
  $("#changeRelay").click(function(){
    var JSONkey, JSONObject, key, object;
	JSONkey = JSON.stringify($('#main').serializeObject());
	key = JSON.parse(JSONkey).active;
	
		if(typeof key != "undefined"){
	
		$("#sidebar1").css("display","none");
		$("#sidebar3").css("display","inline");
		$("#show").attr("disabled", true);
		$("#change").attr("disabled", true);
		$("#delete").attr("disabled", true);
		$("#edit").attr("disabled", true);
		$("#changeRelay").attr("disabled", true);
		$("#rel").attr("disabled", false);
		
		JSONObject = localStorage.getItem(key);
		
		$("#clientPhoneNumberR").val(JSON.parse(JSONObject).clientPhoneNumber);
		$("#clientNameR").val(JSON.parse(JSONObject).clientName);
		$("#clientAddressR").val(JSON.parse(JSONObject).clientAddress);
		$("#typeOfEmergencyR").val(JSON.parse(JSONObject).typeOfEmergency);
		$("#outsideHomeR").val(JSON.parse(JSONObject).outsideHome);
		$("#attendedByR").val(JSON.parse(JSONObject).attendedBy);
		$("#emergencyDetailsR").val(JSON.parse(JSONObject).emergencyDetails);
		$("#latitudeR").val(JSON.parse(JSONObject).latitude);
		$("#longitudeR").val(JSON.parse(JSONObject).longitude);
		$("#timeStampR").val(JSON.parse(JSONObject).timeStamp);
		$("#oldAgencyPhoneNumberR").val(JSON.parse(JSONObject).oldAgencyPhoneNumber);
			
		}
	});
});

$(function(){
		$("#rel").click(function(){	
		
		var key = $("#clientPhoneNumberR").val();
		localStorage.removeItem(key);
		var JSONObject = JSON.stringify($("#relay").serializeObject());
	    localStorage.setItem( key , JSONObject );
	
		$("#sidebar1").css("display","inline");
		$("#sidebar3").css("display","none");
		$("#show").attr("disabled", false);
		$("#edit").attr("disabled", false);
		$("#delete").attr("disabled", false);
		$("change").attr("disabled", false);
		$("#changeRelay").attr("disabled", false);
		$("#relay").trigger("reset");
		$("#rel").attr("disabled", true);
		location.reload();
			
		});
	});





<!--------------------------------------------TEST FUNCTIONS ONLY------------------------------------------------------------------------>
$(function(){
	$('#formData').submit(function(){
		
		var dataKey = $('#keyFetcher').val();
		
		var actualStorageSize = JSON.stringify(localStorage).length;
		$('#result').text("KEY = "+ dataKey + " DATA = " + localStorage.getItem(dataKey) + " SIZE = " + actualStorageSize + " Bytes");
		return false;
    })
})

function storageReset()
{
localStorage.clear();
}

</script>

</head>
<body>
<div id="wrapper">
	<div id="header-wrapper">
		<div id="header" class="container">
			<div id="logo">
				<h1><a href="#">Emergency Center</a></h1>
			</div>
			<div id="menu">
				<ul>
					<li><a href="C:\Users\Ricardo\Documents\GitHub\EmergencyAssistantAppWebpage\WebPage\Pages\Active Emergencies Prototype.html">Homepage</a></li>
					<li><a href="C:\Users\Ricardo\Documents\GitHub\EmergencyAssistantAppWebpage\WebPage\Pages\History Prototype.html">History</a></li>
					<li class="current_page_item"><a>Account Settings</a></li>
					<li><a href="C:\Users\Ricardo\Documents\GitHub\EmergencyAssistantAppWebpage\WebPage\Pages\Login Prototype.html">Log out</a></li>
					
				</ul>
			</div>
		</div>
	</div>
	<!-- end #header -->
	<div id="page">
	
	<!-----Active and Relayed Emergency Containers---->
		<div id="content1">
			<div class="post">
				<h2 id="greeting" class="title">Hi [personName]!</h2>
				<div class="entry1">
					
				<h3>Name:<input type="text" id="" name="" maxlength="40" size="30"required/></h3><br>
				<h3>Username:<input type="text" id="" name="" maxlength="40" size="30"required/></h3><br>
				<h3>Password:<input type="password" id="" name="" maxlength="16" size="30"required/></h3><br>
				<h3>E-mail:<input type="email" id="" name="" pattern="[^ @]*@[^ @]*" ></h3><br>
				<h3>User Type:[employeeType]</h3><br>
				<h3>Company Name:[companyName]</h3><br><br>
					
					
					
				
				<p>
				<button id="change" type="button" class="more">Update</button>
				<button id="show" type="button" class="more" onclick="" form="main">Cancel</button>
				</p>

				

					
					
					
					
					
					
				</div>
			</div>
		</div>
		
		
		
		
		<!-- end #content -->
		
		
		
		
		<!-- end #sidebar -->
		<div style="clear: both;">&nbsp;</div>
	</div>
	<!-- end #page --> 
	
</div>
<div id="footer">
	<p>Copyright (c) 2013 Sitename.com. All rights reserved. Images by <a href="http://fotogrph.com/">Fotogrph</a>. Design by <a href="http://www.freecsstemplates.org/" rel="nofollow">FreeCSSTemplates.org</a>.</p>
</div>
<!-- end #footer -->
</body>
</html>
